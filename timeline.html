<script src="wewe.js"></script>
<script>
    const form = document.getElementById('tlForm');
    const list = document.getElementById('timelineList');

    async function renderTimeline() {
        list.innerHTML = '<p class="muted">Carregando...</p>';
        const items = await projectUtils.getTimeline();

        // Ordenar por ano
        items.sort((a, b) => parseInt(a.year) - parseInt(b.year));

        if (!items.length) {
            list.innerHTML = '<p class="muted">Nenhuma meta. Adicione uma!</p>';
            return;
        }

        list.innerHTML = items.map((i, idx) => `
                <div class="timeline-item">
                    <div class="timeline-meta">
                        <strong>${i.year} - ${i.title}</strong>
                        <div class="muted" style="font-size:12px">Por: ${i.amigo || 'Eu'} em ${i.date ? i.date.substring(0, 10) : '-'}</div>
                    </div>
                    <div class="timeline-actions">
                        <button class="btn-small btn-del" onclick="deleteItem(${idx})">X</button>
                    </div>
                </div>
            `).join('');
    }

    renderTimeline();

    form.addEventListener('submit', async e => {
        e.preventDefault();
        const year = document.getElementById('year').value;
        const title = document.getElementById('title').value;
        const amigo = document.getElementById('amigo').value;

        const btn = form.querySelector('button');
        btn.innerText = 'Salvando...';

        await projectUtils.saveTimelineItem({ year, title, amigo, date: new Date().toLocaleString() });

        btn.innerText = 'Adicionar';
        form.reset();
        renderTimeline();
    });

    // Função global para o botão delete funcionar
    window.deleteItem = async (index) => {
        if (!confirm('Excluir?')) return;
        const items = await projectUtils.getTimeline();
        items.splice(index, 1); // Remove pelo índice
        list.innerHTML = '<p class="muted">Atualizando...</p>';
        await projectUtils.updateFullTimeline(items);
        renderTimeline();
    }
</script>
</body>

</html>