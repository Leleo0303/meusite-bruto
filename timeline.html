<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Linha do Tempo — 2026–2030</title>
    <link rel="stylesheet" href="ee.css">
</head>

<body>
    <header class="topbar">
        <div class="logo-circle small">CA</div>
        <nav class="mini-nav"><a href="index.html" class="link">Home</a></nav>
    </header>
    <main class="content card elevated">
        <h1>Linha do Tempo — 2026 a 2030</h1>
        <p class="muted">Adicione marcos por ano. Salvamos no navegador.</p>
        <form id="tlForm" style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <select id="year" required>
                <option>2026</option>
                <option>2027</option>
                <option>2028</option>
                <option>2029</option>
                <option>2030</option>
            </select>
            <input id="title" placeholder="Título do marco" required
                style="flex:1;padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06)">
            <button class="btn" type="submit">Adicionar</button>
        </form>

        <div id="timelineList" style="margin-top:12px"></div>
    </main>

    <script src="wewe.js"></script>
    <script>
        const form = document.getElementById('tlForm');
        const list = document.getElementById('timelineList');

        // Função atualizada para usar a busca assíncrona
        async function renderTimeline() {
            list.innerHTML = '<p class="muted">Carregando metas colaborativas...</p>';

            // Agora a busca espera pelos dados do JSONBin.io
            const items = await projectUtils.getTimeline();

            // Ordena os itens (opcional, mas bom para a timeline)
            items.sort((a, b) => (parseInt(a.year) > parseInt(b.year)) ? 1 : -1);

            if (!items.length) {
                list.innerHTML = '<p class="muted">Nenhuma meta ainda. Seja o primeiro a adicionar!</p>';
            } else {
                list.innerHTML = items.map(i => {
                    const addedBy = i.amigo ? `por ${i.amigo}` : 'por você';
                    return `<div class="timeline-item">
                                <strong>${i.title}</strong> 
                                <small class="muted">${i.year} • ${addedBy} • ${i.date.substring(0, 10)}</small>
                            </div>`
                }).join('');
            }
        }

        // Renderiza a timeline ao carregar a página
        renderTimeline();

        // Lógica de Submissão
        form.addEventListener('submit', async e => {
            e.preventDefault();

            // Pega os valores do formulário
            const year = document.getElementById('year').value;
            const title = document.getElementById('title').value;
            const amigo = document.getElementById('amigo').value || 'Anônimo';

            const obj = {
                year,
                title,
                date: new Date().toLocaleString(),
                amigo // Adiciona o campo do amigo
            };

            const status = await projectUtils.saveTimelineItem(obj);

            if (status) {
                renderTimeline();
                document.getElementById('title').value = ''; // Limpa só o título
            } else {
                alert("Erro ao salvar a meta colaborativa. Verifique as chaves no wewe.js.");
            }
        });
    </script>
</body>

</html>